<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Cat Clicker</title>

    <style>
        *[hidden] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="catClicker" id="catsHolder">
    </div>

    <script>

        const catsModel = {
            initialCatsData:  [
                {
                    name: "abc asda",
                    img: "./cat_images/1.jpg"
                },
                {
                    name: "CDEF",
                    img: "./cat_images/2.jpg"
                }
            ],
            cats: {},
            initializeModel() {
                this.initialCatsData.forEach(({name, img}) => {
                    let id = name.split(" ").join("_");
                    this.cats[id] = {
                        name,
                        img,
                        id,
                        clicked: 0
                    };
                });
            },
            getAllCats() {
                return Object.values(this.cats);
            },
            getCatById(id) {
                return this.cats.hasOwnProperty(id) ? this.cats[id] : null;
            },
            getCatClickCountById(id) {
                return this.cats.hasOwnProperty(id) ? this.cats[id].clicked : null;
            },
            updateCatClickCountById(id) {
                this.cats[id].clicked = this.cats[id].clicked + 1;
                return this.cats[id].clicked;
            }
        };

        const catsView = {
            catsHolder: null,
            clickedMsgHoldersMap: {},
            getClickedMsg(count) {
                return count > 0 ? (
                    `You have clicked the cat ${count} times`
                ) : (
                    `Come on! Click the cat already!`
                ); 
            },
            initializeUI(catsList, clickListener) {
                this.catsHolder = document.getElementById("catsHolder");
                catsList.forEach(({name, id, img, clicked}) => {
                    let indiCatHolder = document.createElement("div");
                    let catImg = document.createElement("img");
                    let catClickedCountMessage = document.createElement("h3");
                    let catName = document.createElement("h2");

                    indiCatHolder.id = id;
                    
                    catImg.src = img;
                    catImg.name = id;
                    catImg.alt = `Cute pic of ${name}`;

                    catImg.addEventListener("click", clickListener);

                    catClickedCountMessage.innerHTML = this.getClickedMsg(clicked);
                    catClickedCountMessage.id = `${id}_click_msg`;

                    catName.innerHTML = `${name}`;

                    indiCatHolder.append(catName, catImg, catClickedCountMessage);

                    this.clickedMsgHoldersMap[id] = catClickedCountMessage;
                    this.catsHolder.appendChild(indiCatHolder);
                });
            },
            updateClickMsg(id, count) {
                this.clickedMsgHoldersMap[id].innerHTML = this.getClickedMsg(count);
            }
        };

        const catsController = {
            handleClick(event) {
                let clickedCatId = event.target.name;
                let newClickCount = catsModel.updateCatClickCountById(clickedCatId);
                catsView.updateClickMsg(clickedCatId, newClickCount);
            },
            initialize() {
                catsModel.initializeModel();
                catsView.initializeUI(catsModel.getAllCats(), this.handleClick);
            }
        };

        window.onload = () => {catsController.initialize()};
    </script>
</body>
</html>